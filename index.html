<!DOCTYPE! html>
<html lang="eng">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" contant="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="shortcut icon" type="image/png" href="/favicon.png" />
    <title>петрогард restaurant</title>
</head>

<body>

    <h1 id="logo">"петрогард" restaurant</h1>

    <nav>
        <!--
        <a href="">Home</a>
        <a href="">Contact</a>-->
    </nav>

    <main>


    </main>

    <div id="overlay" onclick="off()">
        <p id="text">More information about the given dish</p>
    </div>

    <template>

        <article>

            <h1>TITLE</h1>
            <h2 class="current-price">PRICE</h2>
            <h2 class="new-price">DISCOUNT PRICE</h2>
            <p class="description">ABOUT THE DISH</p>
            <img class="dish" src="" alt="dish picture">


            <div class="icons">
                <img class="icon-veg" src="" alt="icon-veggie">
                <img class="icon-alco" src="" alt="icon-alcohol">
                <img class="icon-allergy" src="" alt="icon-allergy">
            </div>

            <button class="button-info">More</button>

        </article>

    </template>

    <footer>made by ксаwеры</footer>



    <script>
        // More information button

        function on() {
            document.getElementById("overlay").style.display = "block";
        }

        function off() {
            document.getElementById("overlay").style.display = "none";
        }


        // Template constants

        const template = document.querySelector("template").content; //select the template

        const imgLink = "https://kea-alt-del.dk/t5/site/imgs/";

        const catLink = "https://kea-alt-del.dk/t5/api/categories";

        const productlistLink = "https://kea-alt-del.dk/t5/api/productlist";

        const productLink = "https://kea-alt-del.dk/t5/api/product?id=";

        const modal = document.getElementById("overlay");

        const main = document.querySelector("main"); // select a container element

        const nav = document.querySelector("nav");


        // MODAL SECTIONS

        fetch(catLink).then(result => result.json()).then(data => createCatSections(data));

        // Function

        function createCatSections(categories) {
            console.log(categories);
            categories.forEach(cat => {
                const newSection = document.createElement("section");
                const newHeader = document.createElement("h1");
                const newA = document.createElement("a");

                newA.textContent = cat;
                newA.href = "#";
                newA.addEventListener("click", () => showCategory(cat));
                nav.appendChild(newA);
                newSection.id = cat;

                newHeader.textContent = cat;
                newSection.appendChild(newHeader);
                main.appendChild(newSection);
            })

            fetch(productlistLink).then(e => e.json()).then(data => data.forEach(showData));
        }

        function showCategory(category) {
            console.log(category);
            document.querySelectorAll("main > section").forEach(section => {
                if (section.id == category || category == "all") {
                    section.style.display = "grid";

                } else {
                    section.style.display = "none";
                }
            })
        }


        function showData(oneObject) {

            const section = document.querySelector("#" + oneObject.category);
            let clone = template.cloneNode(true);
            clone.querySelector("h1").textContent = oneObject.name;
            clone.querySelector("h2.current-price").textContent = oneObject.price + " kr";
            clone.querySelector("h2.new-price").textContent = oneObject.price - (oneObject.price * (oneObject.discount / 100)) + " kr"; //%
            clone.querySelector("p.description").textContent = oneObject.shortdescription;
            clone.querySelector("img").src = "https://kea-alt-del.dk/t5/site/imgs/small/" + oneObject.image + "-sm.jpg";
            clone.querySelector("img.icon-veg").src = "imgs/leaf.png";
            clone.querySelector("img.icon-alco").src = "imgs/percent.png";
            clone.querySelector("img.icon-allergy").src = "imgs/rash.png";


            // OVERLAY INFORMATION

            clone.querySelector(".button-info").addEventListener("click", function() {
                fetch("http://kea-alt-del.dk/t5/api/product?id=" + oneObject.id).then(e => e.json()).then(data => showOne(data))
            })

            function showOne(product) {
                console.log(product.longdescription)
                modal.querySelector("#overlay p").textContent = product.longdescription;
                modal.style.display = "block";
            }


            // IF STATEMENT - DISPLAY OF PRICE

            if (oneObject.discount > 0) {
                clone.querySelector(".current-price").classList.add("current-price");
                clone.querySelector("h2.current-price").classList.add("on-discount");

            } else {
                clone.querySelector(".new-price").remove();
            }


            // IF STATEMENT - DEFINING THE SOLD OUT

            if (oneObject.soldout == true) {
                const article = clone.querySelector("article");
                article.classList.add("soldout");
                const message = document.createElement("h1");
                message.textContent = "SOLD OUT";
                message.classList.add("overlay");
                article.appendChild(message);
            }

            // IF STATEMENT - defining the display of the vegetarian, alcoholic and allergy(need improvement) icons

            if (oneObject.vegetarian == false) {
                clone.querySelector('.icon-veg').remove();
            }

            if (oneObject.alcohol == false) {
                clone.querySelector('.icon-alco').remove();
            }

            /*if (oneObject.allergens.length > 0) {
                clone.querySelector('.icon-allergy').remove();
            }*/

            section.appendChild(clone);
        }
    </script>


</body>
</html>
